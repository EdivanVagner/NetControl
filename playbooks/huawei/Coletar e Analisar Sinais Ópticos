---
- name: üîç Coletar e Analisar Sinais √ìpticos (Rx) em Switches Huawei
  hosts: huawei_switch
  gather_facts: no
  connection: network_cli
  
  # Vari√°veis de Conex√£o (Ajuste conforme seu ambiente)
  vars:
    ansible_network_os: community.network.cnos
    ansible_user: "AlphaSoares"
    ansible_password: "Soares99RS@"
    
  tasks:
    - name: üìä Executar 'display interface transceiver verbose'
      ansible.netcommon.cli_command:
        command: display interface transceiver verbose
      register: optical_output
      
    # ------------------ NOVA TASK: AN√ÅLISE DE DADOS --------------------
    # O comando VRP retorna muitos dados, vamos extrair o Rx Power
    - name: ‚úÇÔ∏è Extrair o valor de Rx Power usando Regex
      ansible.builtin.set_fact:
        # Regex (Exemplo): Procura por "Rx Power" seguido por n√∫meros e dBm
        # O Regex pode precisar de ajuste dependendo da sua vers√£o VRP
        rx_power_match: "{{ optical_output.stdout[0] | regex_search('Rx Power\\s+:\\s+([-\\d\\.]+)\\s+dBm', '\\1') }}"
      
    - name: üìã Exibir o valor de Rx Power no console
      ansible.builtin.debug:
        msg: |
          ---
          DISPOSITIVO: {{ inventory_hostname }}
          STATUS: Coleta Conclu√≠da
          RX POWER ENCONTRADO: {{ rx_power_match | default('N√ÉO ENCONTRADO') }} dBm
          ---
